function esInitGl(b){var a=document.getElementById(b);var d=null;try{d=a.getContext("webgl")}catch(c){}if(d==null){try{d=a.getContext("experimental-webgl")}catch(c){}}return d}function esInitSw(b){var a=document.getElementById(b);return a.getContext("2d")}function esNextFrame(b){var c=Date.now();function a(){var d=Date.now();if(!b((d-c)*0.001)){window.requestAnimationFrame(a)}c=d}window.requestAnimationFrame(a)}var ES_VERTEX=1;var ES_FRAGMENT=2;function esProgram(a){this.gl=a;this.program=a.createProgram()}function compileShader(d,c,a){if(a==ES_VERTEX){a=d.VERTEX_SHADER}else{a=d.FRAGMENT_SHADER}var b=d.createShader(a);d.shaderSource(b,c);d.compileShader(b);if(!d.getShaderParameter(b,d.COMPILE_STATUS)){alert(d.getShaderInfoLog(b))}return b}esProgram.prototype.addShaderId=function(a,b){var c=document.getElementById(a).text;this.gl.attachShader(this.program,compileShader(this.gl,c,b))};esProgram.prototype.getUniform=function(a){return this.gl.getUniformLocation(this.program,a)};esProgram.prototype.link=function(){this.gl.linkProgram(this.program)};esProgram.prototype.use=function(){this.gl.useProgram(this.program)};var ES_LOAD_IMAGE=1;var ES_LOAD_AUDIO=2;function esLoad(){this.list=[]}esLoad.prototype.loadImage=function(a){var b=new Image();this.list.push([b,a,ES_LOAD_IMAGE]);return b};esLoad.prototype.loadAudio=function(a){var b=new Audio();this.list.push([b,a,ES_LOAD_AUDIO]);return b};esLoad.prototype.download=function(h){var g=this.list.length;for(var b=0;b<this.list.length;b++){var e=this.list[b];var f=e[0];var a=e[1];var c=e[2];var d=(function(j,i){return function(){g--;if(g==0){h()}}})(f,a);switch(c){default:case ES_LOAD_IMAGE:f.onload=d;f.src=a;break;case ES_LOAD_AUDIO:f.addEventListener("canplaythrough",d,false);f.src=a;break}}};function esFullFrame(b,d){var a=document.getElementById(b);a.style="padding: 0px; margin: 0px; position: absolute; left: 0px; top: 0px;";var c=function(){var e=window.innerWidth;var f=window.innerHeight;a.width=e;a.height=f;d(e,f)};window.addEventListener("resize",c,false);c()}function vec3_create(){return new Float32Array([0,0,0])}function vec3_parse(a,c,b){return new Float32Array([a,c,b])}function vec3_add(b,a,c){b[0]=a[0]+c[0];b[1]=a[1]+c[1];b[2]=a[2]+c[2]}function vec3_sub(b,a,c){b[0]=a[0]-c[0];b[1]=a[1]-c[1];b[2]=a[2]-c[2]}function vec3_mulk(c,b,a){c[0]=a*b[0];c[1]=a*b[1];c[2]=a*b[2]}function vec3_length(a){return Math.sqrt(a[0]*a[0]+a[1]*a[1]+a[2]*a[2])}function vec3_dot(a,b){return a[0]*b[0]+a[1]*b[1]+a[2]*b[2]}function vec3_isZero(a){return a[0]==0&&a[1]==0&&a[2]==0}function vec3_cross(b,a,c){b[0]=a[1]*c[2]-a[2]*c[1];b[1]=a[2]*c[0]-a[0]*c[2];b[2]=a[0]*c[1]-a[1]*c[0]}function vec3_normalize(c,b){var a=1/vec3_length(b);c[0]=a*b[0];c[1]=a*b[1];c[2]=a*b[2]}function mat4_create(){return new Float32Array([0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0])}function mat4_identity(a){a[0]=1;a[1]=a[2]=a[3]=0;a[5]=1;a[4]=a[6]=a[7]=0;a[10]=1;a[8]=a[9]=a[11]=0;a[15]=1;a[12]=a[13]=a[14]=0}function mat4_mul(b,c,a){b[0]=c[0]*a[0]+c[1]*a[4]+c[2]*a[8]+c[3]*a[12];b[1]=c[0]*a[1]+c[1]*a[5]+c[2]*a[9]+c[3]*a[13];b[2]=c[0]*a[2]+c[1]*a[6]+c[2]*a[10]+c[3]*a[14];b[3]=c[0]*a[3]+c[1]*a[7]+c[2]*a[11]+c[3]*a[15];b[4]=c[4]*a[0]+c[5]*a[4]+c[6]*a[8]+c[7]*a[12];b[5]=c[4]*a[1]+c[5]*a[5]+c[6]*a[9]+c[7]*a[13];b[6]=c[4]*a[2]+c[5]*a[6]+c[6]*a[10]+c[7]*a[14];b[7]=c[4]*a[3]+c[5]*a[7]+c[6]*a[11]+c[7]*a[15];b[8]=c[8]*a[0]+c[9]*a[4]+c[10]*a[8]+c[11]*a[12];b[9]=c[8]*a[1]+c[9]*a[5]+c[10]*a[9]+c[11]*a[13];b[10]=c[8]*a[2]+c[9]*a[6]+c[10]*a[10]+c[11]*a[14];b[11]=c[8]*a[3]+c[9]*a[7]+c[10]*a[11]+c[11]*a[15];b[12]=c[12]*a[0]+c[13]*a[4]+c[14]*a[8]+c[15]*a[12];b[13]=c[12]*a[1]+c[13]*a[5]+c[14]*a[9]+c[15]*a[13];b[14]=c[12]*a[2]+c[13]*a[6]+c[14]*a[10]+c[15]*a[14];b[15]=c[12]*a[3]+c[13]*a[7]+c[14]*a[11]+c[15]*a[15]}function mat4_lookAt(e,c,b,a){var h=vec3_create();vec3_sub(h,b,c);vec3_normalize(h,h);var g=vec3_create();vec3_cross(g,a,h);vec3_normalize(g,g);var f=mat4_create();f[0]=g[0];f[4]=g[1];f[8]=g[2];f[1]=a[0];f[5]=a[1];f[9]=a[2];f[2]=-h[0];f[6]=-h[1];f[10]=-h[2];var d=mat4_create();mat4_identity(d);d[12]=-c.x;d[13]=-c.y;d[14]=-c.z;mat4_mul(e,f,d)};